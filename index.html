<!--
[JST 2026-01-18 16:00]  idol_member_quiz_v20260118-01.html
アイドルグループ「どっちがメンバー？」クイズ（10問固定）
要件:
- 問題データは別JS（GROUPS）参照
- 開始ボタンは「次へ」ボタンの左
- 開始押下後、10問終了まで開始ボタン非表示
- 出題数選択なし（10問固定）
- 上部タイトル横の「問題/正解/不正解」表示なし
- 最後に結果表示
- members が空のグループは出題対象から除外（空白答え防止）
- Edge95想定（古い環境でも動く書き方）
-->

<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>どっちがメンバー？（昭和・平成・令和）</title>

  <style>
    :root{
      --bg:#0e1326;
      --panel:rgba(255,255,255,0.08);
      --panel2:rgba(255,255,255,0.12);
      --text:#f3f6ff;
      --muted:rgba(243,246,255,0.75);
      --accent:#7aa6ff;
      --danger:#ff6b6b;
      --ok:#67d98b;
      --btn:#1b2342;
      --btn2:#24305a;
      --border:rgba(255,255,255,0.16);
      --shadow:0 10px 30px rgba(0,0,0,0.35);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
      background: radial-gradient(1200px 600px at 50% 0%, rgba(122,166,255,0.20), transparent 60%),
                  radial-gradient(900px 600px at 10% 20%, rgba(103,217,139,0.12), transparent 60%),
                  radial-gradient(900px 600px at 90% 20%, rgba(255,107,107,0.10), transparent 60%),
                  var(--bg);
      color: var(--text);

      /* 文字を大きく（全体基準） */
      font-size: 20px;
      line-height: 1.5;
    }

    .wrap{
      max-width: 860px;
      margin: 0 auto;
      padding: 14px 12px 22px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 14px;
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow);
    }

    .title{
      font-weight: 800;
      letter-spacing: 0.5px;
      font-size: 20px;
      display:flex;
      align-items:baseline;
      gap:10px;
      flex-wrap:wrap;
    }
    .subtitle{
      font-size: 14px;
      color: var(--muted);
      font-weight: 600;
    }

    .card{
      margin-top: 12px;
      padding: 16px 14px;
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow);
    }

    /* 問題文：おすすめ 26px */
    #question{
      font-size: 26px;
      font-weight: 800;
      line-height: 1.35;
      margin: 0 0 14px 0;
      word-break: break-word;
    }

    .meta{
      margin: 0 0 14px 0;
      color: var(--muted);
      font-size: 16px;
    }
    .pill{
      display:inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(122,166,255,0.16);
      border:1px solid rgba(122,166,255,0.28);
      color: var(--text);
      font-weight: 700;
      margin-right: 8px;
      font-size: 14px;
    }

    .choices{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 8px;
    }

    /* 選択肢：おすすめ 24px */
    .choiceBtn{
      width: 100%;
      text-align: center;
      padding: 18px 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--btn2), var(--btn));
      color: var(--text);
      font-size: 24px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 10px 18px rgba(0,0,0,0.25);
      user-select:none;
    }
    .choiceBtn:active{
      transform: translateY(1px);
      filter: brightness(1.05);
    }
    .choiceBtn[disabled]{
      opacity: 0.65;
      cursor: default;
      transform: none;
    }

    .feedback{
      margin-top: 12px;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--panel2);
      font-weight: 800;
      min-height: 52px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .fbText{
      font-size: 20px;
      line-height: 1.4;
    }
    .fbOk{ color: var(--ok); }
    .fbNg{ color: var(--danger); }
    .fbHint{
      color: var(--muted);
      font-size: 16px;
      font-weight: 700;
    }

    .controls{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }

    /* ボタン：おすすめ 20px */
    .ctrlBtn{
      flex:1;
      padding: 14px 10px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-size: 20px;
      font-weight: 900;
      cursor: pointer;
      user-select:none;
    }
    .ctrlBtn.primary{
      background: rgba(122,166,255,0.22);
      border-color: rgba(122,166,255,0.35);
    }
    .ctrlBtn:active{ transform: translateY(1px); }
    .ctrlBtn[disabled]{ opacity: 0.55; cursor: default; transform:none; }

    .resultBox{
      margin-top: 12px;
      padding: 16px 14px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: var(--panel);
      box-shadow: var(--shadow);

      /* 結果：おすすめ 22px */
      font-size: 22px;
      line-height: 1.6;
    }
    .resultTitle{
      font-weight: 900;
      font-size: 24px;
      margin: 0 0 8px 0;
    }
    .small{
      color: var(--muted);
      font-size: 16px;
      font-weight: 700;
      margin-top: 8px;
    }

    .hide{ display:none !important; }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="title">
        どっちがメンバー？
        <span class="subtitle">昭和・平成・令和</span>
      </div>
    </div>

    <div id="quizCard" class="card">
      <div class="meta">
        <span class="pill">10問固定</span>
        <span class="pill">2択</span>
        <span class="pill">ランダム</span>
      </div>

      <p id="question">開始を押してください。</p>

      <div class="choices">
        <button id="btnA" class="choiceBtn" disabled>—</button>
        <button id="btnB" class="choiceBtn" disabled>—</button>
      </div>

      <div id="feedback" class="feedback">
        <div class="fbText" id="fbText">—</div>
        <div class="fbHint" id="fbHint">—</div>
      </div>

      <!-- 仕様: 開始ボタンは次へボタンの左 -->
      <div class="controls">
        <button id="startBtn" class="ctrlBtn primary">開始</button>
        <button id="nextBtn" class="ctrlBtn" disabled>次へ</button>
      </div>

      <div id="resultBox" class="resultBox hide">
        <div class="resultTitle">結果</div>
        <div id="resultText">—</div>
        <div class="small">もう一度やる場合は「開始」を押してください。</div>
      </div>

    </div>
  </div>

  <!-- データJS（同じフォルダに置く） -->
  <script src="groups_data_v20260118-01.js"></script>

  <script>
    // Edge95向け：古い書き方（var / function）
    (function(){
      // ===== 設定 =====
      var TOTAL_Q = 10;

      // ===== 要素参照 =====
      var elQ = document.getElementById("question");
      var btnA = document.getElementById("btnA");
      var btnB = document.getElementById("btnB");
      var startBtn = document.getElementById("startBtn");
      var nextBtn = document.getElementById("nextBtn");
      var fbText = document.getElementById("fbText");
      var fbHint = document.getElementById("fbHint");
      var resultBox = document.getElementById("resultBox");
      var resultText = document.getElementById("resultText");

      // ===== 状態 =====
      var validGroups = [];
      var questions = []; // 10問分を先に作る
      var idx = -1;
      var correct = 0;
      var wrong = 0;
      var answered = false;

      // ===== ユーティリティ =====
      function randInt(n){
        return Math.floor(Math.random() * n);
      }
      function shuffle2(a, b){
        // 2要素シャッフル
        if(Math.random() < 0.5) return [a, b];
        return [b, a];
      }
      function pickRandomFromArray(arr){
        return arr[randInt(arr.length)];
      }

      function normalizeName(s){
        // 比較用：空白を少し丸める程度（厳密不要）
        return (s || "").replace(/\s+/g, " ").trim();
      }

      // ===== 出題候補を作る（members空対策） =====
      function buildValidGroups(){
        if(!window.GROUPS || !GROUPS.length){
          validGroups = [];
          return;
        }
        var tmp = [];
        for(var i=0;i<GROUPS.length;i++){
          var g = GROUPS[i];
          if(g && g.members && g.members.length > 0){
            tmp.push(g);
          }
        }
        validGroups = tmp;
      }

      // ===== 10問を作成 =====
      function buildQuestions(){
        questions = [];
        if(validGroups.length < 2){
          return;
        }

        var used = {}; // 同一グループ連続を避けたい場合などに拡張可（今回は10問ランダム固定）
        for(var q=0; q<TOTAL_Q; q++){
          var g = validGroups[randInt(validGroups.length)];

          // 正解メンバー
          var rightName = pickRandomFromArray(g.members);

          // 外れメンバー（別グループから）
          var other = null;
          var tries = 0;
          while(tries < 50){
            other = validGroups[randInt(validGroups.length)];
            if(other.id !== g.id && other.members && other.members.length > 0) break;
            tries++;
          }
          var wrongName = pickRandomFromArray(other.members);

          // たまたま同名回避（まれ）
          tries = 0;
          while(normalizeName(wrongName) === normalizeName(rightName) && tries < 20){
            wrongName = pickRandomFromArray(other.members);
            tries++;
          }

          questions.push({
            era: g.era,
            group: g.group,
            correctName: rightName,
            wrongName: wrongName
          });
        }
      }

      // ===== 表示制御 =====
      function setChoiceButtonsEnabled(enabled){
        btnA.disabled = !enabled;
        btnB.disabled = !enabled;
      }

      function setFeedback(text, ok){
        fbText.className = "fbText " + (ok ? "fbOk" : "fbNg");
        fbText.textContent = text;
      }

      function resetFeedback(){
        fbText.className = "fbText";
        fbText.textContent = "—";
        fbHint.textContent = "—";
      }

      function showQuestion(i){
        if(i < 0 || i >= questions.length){
          return;
        }
        answered = false;
        nextBtn.disabled = true;
        setChoiceButtonsEnabled(true);
        resetFeedback();

        var q = questions[i];
        elQ.textContent = "どっちが『" + q.group + "』のメンバー？";

        // 選択肢シャッフル
        var pair = shuffle2(q.correctName, q.wrongName);
        btnA.textContent = pair[0];
        btnB.textContent = pair[1];

        // 正解がどっちか
        btnA.setAttribute("data-is-correct", pair[0] === q.correctName ? "1" : "0");
        btnB.setAttribute("data-is-correct", pair[1] === q.correctName ? "1" : "0");

        fbHint.textContent = (i+1) + " / " + TOTAL_Q;
      }

      function finish(){
        // 結果表示
        resultBox.classList.remove("hide");
        var score = correct + " / " + TOTAL_Q;
        resultText.innerHTML =
          "正解数: <b>" + correct + "</b><br>" +
          "不正解: <b>" + wrong + "</b><br>" +
          "スコア: <b>" + score + "</b>";

        // ボタン制御
        setChoiceButtonsEnabled(false);
        nextBtn.disabled = true;

        // 仕様: 10問終わったら開始ボタンを戻す（再スタート可能）
        startBtn.classList.remove("hide");
        startBtn.textContent = "もう一度（開始）";
      }

      // ===== イベント =====
      function onChoiceClick(e){
        if(answered) return;
        answered = true;

        var isCorrect = e.currentTarget.getAttribute("data-is-correct") === "1";
        var q = questions[idx];

        // ボタン無効化（連打防止）
        setChoiceButtonsEnabled(false);

        if(isCorrect){
          correct++;
          setFeedback("正解", true);
        }else{
          wrong++;
          setFeedback("不正解（正解: " + q.correctName + "）", false);
        }

        // 次へ解放
        nextBtn.disabled = false;
      }

      function startGame(){
        buildValidGroups();

        if(validGroups.length < 2){
          elQ.textContent = "出題できるデータが足りません（membersが空のグループが多い可能性があります）。";
          setFeedback("データ（GROUPS）を確認してください。", false);
          fbHint.textContent = "—";
          return;
        }

        // 初期化
        correct = 0;
        wrong = 0;
        idx = 0;
        resultBox.classList.add("hide");
        startBtn.classList.add("hide"); // 仕様: 開始押下後、10問終わるまで非表示
        startBtn.textContent = "開始";

        buildQuestions();
        showQuestion(idx);
      }

      function nextQuestion(){
        if(idx < 0) return;
        idx++;
        if(idx >= TOTAL_Q){
          finish();
          return;
        }
        showQuestion(idx);
      }

      // 初期表示
      buildValidGroups();
      resetFeedback();
      setChoiceButtonsEnabled(false);

      // ハンドラ登録
      btnA.addEventListener("click", onChoiceClick, false);
      btnB.addEventListener("click", onChoiceClick, false);
      startBtn.addEventListener("click", function(){
        startGame();
      }, false);
      nextBtn.addEventListener("click", function(){
        nextQuestion();
      }, false);

    })();
  </script>
</body>
</html>